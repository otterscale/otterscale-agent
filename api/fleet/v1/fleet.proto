edition = "2023";

package otterscale.fleet.v1;

import "api/annotations.proto";

option go_package = "github.com/otterscale/otterscale-agent/api/fleet/v1;pb";

// FleetService manages the lifecycle of agent-to-server tunnel connections,
// including registration and health checking.
service FleetService {
  // Register allows an agent to register itself with the tunnel server.
  // The agent sends its cluster identity and tunnel port; the server responds
  // with its fingerprint so the agent can verify the tunnel connection.
  // Authentication is provided via gRPC metadata (Basic Auth).
  rpc Register(RegisterRequest) returns (RegisterResponse) {
    option (otterscale.api.feature) = {
      name: "fleet-enabled"
    };
  };
}

// RegisterRequest contains the agent's cluster identity and tunnel port.
message RegisterRequest {
  // The cluster identifier this agent belongs to.
  string cluster = 1;

  // The agent identifier this agent uses to register with the server.
  string agent_id = 2;
}

// RegisterResponse contains the server's fingerprint for the agent to verify the connection.
message RegisterResponse {
  // The server's tunnel fingerprint, used by the agent to verify the connection.
  string fingerprint = 1;

    // The token for the agent to register with the server.
  string token = 2;

  // The port of the tunnel server.
  int32 tunnel_port = 3;
}
